{% extends 'base.html' %}

{% block title %}PI-SA√öDE/ Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
  <div class="row g-4">

    <!-- üåç MAPA (lado esquerdo) -->
    <div class="col-lg-7">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white fw-semibold">
          <i class="bi bi-geo-alt-fill me-2"></i>{{ _('Locations and Resources Map') }}
        </div>
        <div class="card-body p-0">
          <div id="map" style="height: 480px; width: 100%; border-radius: 0 0 8px 8px;"></div>
        </div>
      </div>
    </div>

    <!-- üìä GRAFICO (lado direito) -->
    <div class="col-lg-5">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white fw-semibold">
          <i class="bi bi-bar-chart-fill me-2"></i>{{ _('Training and Candidate Statistics') }}
        </div>
        <div class="card-body">
          <canvas id="trainingChart" height="380"></canvas>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ======= SCRIPTS DO MAPA E GRAFICO ======= -->

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // ============================
  //  MAPA: Locais e Recursos
  // ============================
  const map = L.map('map').setView([-25.97, 32.58], 6); // posi√ß√£o inicial Mo√ßambique

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);

  // Exemplo de dados ‚Äî substitua pelo fetch da sua API
  const locations = [
    { name: "Maputo Central", lat: -25.9653, lng: 32.5892, resource: "Hospital Militar Central" },
    { name: "Beira", lat: -19.8436, lng: 34.8389, resource: "Base Militar Beira" },
    { name: "Nampula", lat: -15.116, lng: 39.2666, resource: "Centro de Forma√ß√£o Militar" }
  ];

  locations.forEach(loc => {
    L.marker([loc.lat, loc.lng])
      .addTo(map)
      .bindPopup(`<b>${loc.name}</b><br>${loc.resource}`);
  });

  // ============================
  //  GRAFICO: Estat√≠sticas Anuais
  // ============================
  const ctx = document.getElementById('trainingChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['2021', '2022', '2023', '2024', '2025'],
      datasets: [
        {
          label: '{{ _("Total Candidates/Persons") }}',
          data: [120, 180, 210, 260, 310], // substituir com dados reais da API
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        },
        {
          label: '{{ _("Militar in Training") }}',
          data: [40, 70, 100, 150, 190], // substituir com dados reais da API
          backgroundColor: 'rgba(255, 159, 64, 0.6)',
          borderColor: 'rgba(255, 159, 64, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Number of Persons' } },
        x: { title: { display: true, text: 'Year' } }
      },
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { mode: 'index', intersect: false }
      }
    }
  });
</script>
{% endblock %}

